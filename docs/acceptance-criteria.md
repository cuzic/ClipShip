# ClipShip 受入条件チェックリスト

## 概要

本ドキュメントは、ClipShip の各ユーザーストーリーに対する受入条件をチェックリスト形式でまとめたものである。

---

## Epic 1: 初期セットアップ

### US-1.1: 拡張機能のインストール

> **Note**: 本セクションは Chrome Web Store 公開後に検証する。開発時はスキップ可。

#### 前提条件
- [ ] Chrome ブラウザがインストールされている
- [ ] Chrome Web Store にアクセスできる

#### 受入条件
- [ ] Chrome Web Store で「ClipShip」を検索すると拡張機能が表示される
- [ ] 「Chromeに追加」ボタンをクリックするとインストールが開始される
- [ ] インストール確認ダイアログが表示される
- [ ] インストール完了後、ツールバーに ClipShip アイコンが表示される
- [ ] アイコンをクリックするとポップアップが表示される

---

### US-1.2: Netlify トークンの設定

#### 前提条件
- [ ] ClipShip がインストールされている
- [ ] Netlify アカウントを持っている
- [ ] Netlify Personal Access Token を取得済み

#### 受入条件
- [ ] 拡張機能アイコンを右クリックすると「オプション」メニューが表示される
- [ ] 「オプション」をクリックするとオプション画面が開く
- [ ] オプション画面に「Netlify Personal Access Token」の入力欄がある
- [ ] 入力欄は `type="password"` でマスク表示される
- [ ] トークンを入力して「Save」ボタンをクリックできる
- [ ] 保存成功時に「Saved!」メッセージが表示される
- [ ] オプション画面を閉じて再度開くと、入力欄にトークンが入力済みになっている
- [ ] トークンは `chrome.storage.sync` に保存されている

---

### US-1.3: GitHub トークンの設定

#### 前提条件
- [ ] ClipShip がインストールされている
- [ ] GitHub アカウントを持っている
- [ ] GitHub Personal Access Token（gist スコープ）を取得済み

#### 受入条件
- [ ] オプション画面に「GitHub Personal Access Token」の入力欄がある
- [ ] 入力欄の近くに「Scope: gist」の説明がある
- [ ] 入力欄は `type="password"` でマスク表示される
- [ ] トークンを入力して「Save」ボタンをクリックできる
- [ ] Netlify トークンと GitHub トークンを同時に保存できる
- [ ] 保存成功時に「Saved!」メッセージが表示される
- [ ] オプション画面を閉じて再度開くと、入力欄にトークンが入力済みになっている

---

## Epic 2: Netlify デプロイ

### US-2.1: クリップボードからNetlifyへデプロイ

#### 前提条件
- [ ] Netlify トークンが設定済み
- [ ] クリップボードにHTMLコードがコピーされている

#### 受入条件

**ポップアップ表示**
- [ ] 拡張機能アイコンをクリックするとポップアップが表示される
- [ ] ポップアップに「Netlify」ボタンが表示される
- [ ] ボタンは Netlify のブランドカラー（#00AD9F）で表示される

**デプロイ処理**
- [ ] 「Netlify」ボタンをクリックすると処理が開始される
- [ ] 処理中は「Packing & Uploading to Netlify...」と表示される
- [ ] 処理中はボタンが無効化される（二重クリック防止）

**成功時**
- [ ] デプロイ成功後、「Success!」が緑色で表示される
- [ ] `https://[random-name].netlify.app` 形式のURLが表示される
- [ ] URLはクリック可能なリンクになっている
- [ ] URLが自動的にクリップボードにコピーされる
- [ ] 「Copied to clipboard!」メッセージが表示される

**生成されるHTML**
- [ ] クリップボードのテキストが `<body>` 内に埋め込まれる
- [ ] `<!DOCTYPE html>` から始まる完全なHTML構造になる
- [ ] `<meta charset="UTF-8">` が含まれる
- [ ] `<meta name="viewport">` が含まれる

---

### US-2.2: Netlifyデプロイのエラーハンドリング

#### 受入条件

**トークン未設定**
- [ ] Netlify トークンが未設定の場合、「Netlify Token not set in Options.」と表示される
- [ ] エラーメッセージは赤色で表示される
- [ ] API リクエストは送信されない

**クリップボード空**
- [ ] クリップボードが空の場合、「Clipboard is empty.」と表示される
- [ ] エラーメッセージは赤色で表示される

**認証エラー（401）**
- [ ] トークンが無効な場合、「Authentication failed.」と表示される
- [ ] エラーメッセージは赤色で表示される

**APIエラー（その他）**
- [ ] その他のAPIエラーの場合、エラーメッセージが表示される
- [ ] コンソールにエラー詳細がログ出力される

**ネットワークエラー**
- [ ] ネットワーク接続がない場合、適切なエラーメッセージが表示される

---

## Epic 3: GitHub Gist デプロイ

### US-3.1: クリップボードからGistへデプロイ

#### 前提条件
- [ ] GitHub トークンが設定済み
- [ ] クリップボードにHTMLコードがコピーされている

#### 受入条件

**ポップアップ表示**
- [ ] ポップアップに「GistHack」ボタンが表示される
- [ ] ボタンは GitHub のブランドカラー（#333）で表示される
- [ ] 「Netlify」ボタンと横並びで表示される

**デプロイ処理**
- [ ] 「GistHack」ボタンをクリックすると処理が開始される
- [ ] 処理中は「Creating Gist...」と表示される
- [ ] 処理中はボタンが無効化される（二重クリック防止）

**成功時**
- [ ] デプロイ成功後、「Success!」が緑色で表示される
- [ ] `https://gist.githack.com/[user]/[id]/raw/[hash]/index.html` 形式のURLが表示される
- [ ] URLはクリック可能なリンクになっている
- [ ] URLが自動的にクリップボードにコピーされる
- [ ] 「Copied to clipboard!」メッセージが表示される

**Gist設定**
- [ ] Gist は `public: true` で作成される
- [ ] Gist の description は「Deployed via ClipShip」となる
- [ ] ファイル名は `index.html` となる

**URL変換**
- [ ] `gist.githubusercontent.com` が `gist.githack.com` に変換される
- [ ] 変換後のURLをブラウザで開くとHTMLがレンダリングされる

---

### US-3.2: Gistデプロイのエラーハンドリング

#### 受入条件

**トークン未設定**
- [ ] GitHub トークンが未設定の場合、「GitHub Token not set in Options.」と表示される
- [ ] エラーメッセージは赤色で表示される
- [ ] API リクエストは送信されない

**クリップボード空**
- [ ] クリップボードが空の場合、「Clipboard is empty.」と表示される
- [ ] エラーメッセージは赤色で表示される

**認証エラー（401）**
- [ ] トークンが無効な場合、「Authentication failed. Check your token.」と表示される
- [ ] エラーメッセージは赤色で表示される

**権限エラー（403）**
- [ ] gist スコープがない場合、「Permission denied. Check gist scope.」と表示される
- [ ] エラーメッセージは赤色で表示される

**バリデーションエラー（422）**
- [ ] リクエストが不正な場合、エラー詳細が表示される

---

## Epic 4: UI/UX

### US-4.1: ポップアップの視覚的フィードバック

#### 受入条件

**レイアウト**
- [ ] ポップアップの幅は 320px
- [ ] パディングは 15px
- [ ] フォントは sans-serif

**ボタン**
- [ ] ボタンは横並びで表示される
- [ ] ボタン間の間隔は 10px
- [ ] ボタンは角丸（border-radius: 4px）
- [ ] ボタンテキストは白色で太字
- [ ] ホバー時に色が少し暗くなる

**状態表示**
- [ ] ステータスエリアはボタンの下に表示される
- [ ] 成功メッセージは緑色（.success）
- [ ] エラーメッセージは赤色（.error）
- [ ] URLは word-break: break-all で折り返される

**処理中**
- [ ] 処理中はボタンがクリック不可になる
- [ ] 処理中はカーソルが wait になる（オプション）

---

### US-4.2: URLのコピー確認

#### 受入条件

- [ ] URLコピー後、「Copied to clipboard!」メッセージが表示される
- [ ] メッセージはURLの下に表示される
- [ ] メッセージにチェックマーク（✅）が含まれる
- [ ] メッセージは次の操作まで表示され続ける

---

## Epic 5: 開発者向け

### US-5.1: ローカルでの開発

#### 受入条件

**セットアップ**
- [ ] `mise install` で Bun がインストールされる
- [ ] `bun install` で依存関係がインストールされる
- [ ] `lefthook install` で Git hooks がセットアップされる
- [ ] エラーなく完了する

**開発サーバー**
- [ ] `bun run dev` でウォッチビルドが開始される
- [ ] `dist/` フォルダにビルド成果物が出力される
- [ ] ソースファイル変更時に自動で再ビルドされる

**Chrome読み込み**
- [ ] `chrome://extensions` を開ける
- [ ] 「デベロッパーモード」を有効にできる
- [ ] 「パッケージ化されていない拡張機能を読み込む」で `dist/` を選択できる
- [ ] 拡張機能が正常に読み込まれる
- [ ] 拡張機能の再読み込みボタンで変更が反映される

---

### US-5.2: テストの実行

#### 受入条件

**ユニットテスト**
- [ ] `bun run test` でユニットテストが実行される
- [ ] テスト結果（成功/失敗）が表示される
- [ ] 失敗したテストの詳細が表示される
- [ ] 終了コードが適切（成功: 0, 失敗: 1）

**E2Eテスト**
- [ ] `bun run test:e2e` でE2Eテストが実行される
- [ ] Playwright でブラウザが起動する
- [ ] テスト結果が表示される

**テストカバレッジ**
- [ ] 主要な関数がテストされている
  - [ ] `createHtml()` - HTML生成
  - [ ] `deployToNetlify()` - Netlifyデプロイ
  - [ ] `createGist()` - Gist作成
  - [ ] `convertToGistHackUrl()` - URL変換
  - [ ] `getStorageData()` - ストレージ取得

---

### US-5.3: リリースパッケージの作成

#### 受入条件

**ビルド**
- [ ] `bun run build` で本番ビルドが実行される
- [ ] ビルド成果物が minify される
- [ ] `dist/` フォルダに出力される

**リント**
- [ ] `bun run lint` でエラーが出ない
- [ ] `bun run lint:ext` (web-ext lint) でエラーが出ない

**パッケージング**
- [ ] `bun run package` で ZIP ファイルが生成される
- [ ] ZIP ファイル名は `dist.zip` または `clipship-x.x.x.zip`
- [ ] ZIP に以下のファイルが含まれる
  - [ ] `manifest.json`
  - [ ] `popup.html`
  - [ ] `popup.js`
  - [ ] `options.html`
  - [ ] `options.js`
  - [ ] その他の必要なアセット

**サイズ**
- [ ] ZIP ファイルサイズが 500KB 以下

---

### US-5.4: CI/CD による自動化

#### 受入条件

**プルリクエスト時**
- [ ] GitHub Actions ワークフローが起動する
- [ ] `bun install` が実行される
- [ ] `bun run lint` が実行される
- [ ] `bun run test` が実行される
- [ ] `bun run build` が実行される
- [ ] すべて成功するとチェックが緑になる
- [ ] 失敗するとチェックが赤になる

**マージ時**
- [ ] main ブランチへのマージでパッケージが生成される
- [ ] アーティファクトとして ZIP がアップロードされる（オプション）

**ブランチ保護**
- [ ] テスト失敗時はマージがブロックされる

---

## 非機能要件チェックリスト

### パフォーマンス

- [ ] ポップアップは 100ms 以内に表示される
- [ ] Netlify デプロイは 5 秒以内に完了する（通常時）
- [ ] Gist デプロイは 3 秒以内に完了する（通常時）
- [ ] ZIP 生成は 100ms 以内に完了する

### セキュリティ

- [ ] トークンは `chrome.storage.sync` に保存される
- [ ] トークンはコンソールにログ出力されない
- [ ] トークンは画面上でマスク表示される
- [ ] すべての API 通信は HTTPS を使用する
- [ ] XSS 対策: ユーザー入力を適切にエスケープする

### 互換性

- [ ] Chrome 最新版で動作する
- [ ] Manifest V3 に準拠している
- [ ] `clipboardRead` 権限を使用する
- [ ] `storage` 権限を使用する

### コード品質

- [ ] TypeScript で型安全に実装されている
- [ ] Biome でリント・フォーマットされている
- [ ] zod で API レスポンスがバリデーションされている
- [ ] エラーハンドリングが適切に実装されている

### サイズ

- [ ] 拡張機能の合計サイズは 500KB 以下
- [ ] 個別ファイルは 100KB 以下
- [ ] 不要な依存関係が含まれていない
